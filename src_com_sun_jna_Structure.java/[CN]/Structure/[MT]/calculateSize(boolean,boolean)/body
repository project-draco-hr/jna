{
  int size=CALCULATE_SIZE;
  LayoutInfo info;
synchronized (layoutInfo) {
    info=(LayoutInfo)layoutInfo.get(getClass());
  }
  if (info == null || this.alignType != info.alignType || this.typeMapper != info.typeMapper) {
    info=deriveLayout(force,avoidFFIType);
  }
  if (info != null) {
    this.structAlignment=info.alignment;
    this.structFields=info.fields;
    if (!info.variable) {
synchronized (layoutInfo) {
        if (!layoutInfo.containsKey(getClass()) || this.alignType != ALIGN_DEFAULT || this.typeMapper != null) {
          layoutInfo.put(getClass(),info);
        }
      }
    }
    size=info.size;
  }
  return size;
}
