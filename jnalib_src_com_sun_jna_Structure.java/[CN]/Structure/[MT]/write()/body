{
  if (freed) {
    throw new IllegalStateException("Memory has been freed");
  }
  if (size == -1) {
    allocateMemory();
  }
  for (Iterator i=structFields.values().iterator(); i.hasNext(); ) {
    writeField((StructField)i.next());
  }
}
