{
  if (size == CALCULATE_SIZE) {
    allocateMemory(calculateSize(true));
  }
  for (Iterator i=structFields.values().iterator(); i.hasNext(); ) {
    StructField sf=(StructField)i.next();
    if (!sf.isVolatile) {
      writeField(sf);
    }
  }
}
