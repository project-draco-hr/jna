{
  if (size == CALCULATE_SIZE) {
    allocateMemory();
  }
  if (this instanceof ByValue) {
    getTypeInfo();
  }
synchronized (writing) {
    if (writing.contains(this))     return;
    writing.add(this);
  }
  try {
    for (Iterator i=structFields.values().iterator(); i.hasNext(); ) {
      StructField sf=(StructField)i.next();
      if (!sf.isVolatile) {
        writeField(sf);
      }
    }
  }
  finally {
synchronized (writing) {
      writing.remove(this);
    }
  }
}
