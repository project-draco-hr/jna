{
  options=new HashMap(options);
  if (options.get(Library.OPTION_CALLING_CONVENTION) == null) {
    options.put(Library.OPTION_CALLING_CONVENTION,new Integer(Function.C_CONVENTION));
  }
  if (libraryName == null)   throw new NullPointerException("Library name may not be null");
synchronized (libraries) {
    WeakReference ref=(WeakReference)libraries.get(libraryName + options);
    NativeLibrary library=ref != null ? (NativeLibrary)ref.get() : null;
    if (library == null) {
      library=loadLibrary(libraryName,options);
      ref=new WeakReference(library);
      libraries.put(library.getName() + options,ref);
      libraries.put(library.getFile().getAbsolutePath() + options,ref);
      libraries.put(library.getFile().getName() + options,ref);
    }
    return library;
  }
}
