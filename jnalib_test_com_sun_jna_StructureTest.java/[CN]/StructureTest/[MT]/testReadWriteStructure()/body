{
class TestStructure extends Structure {
    public InnerStructure s1;
    public byte[] buffer=new byte[8];
  }
  TestStructure s=new TestStructure();
  s.s1.x=1;
  s.s1.y=2;
  s.buffer[0]=3;
  s.write();
  s.s1.x=s.s1.y=0;
  s.buffer[0]=0;
  byte[] ref=s.buffer;
  s.read();
  assertEquals("Wrong nested struct field value after write/read (x)",1,s.s1.x);
  assertEquals("Wrong nested struct field value after write/read (y)",2,s.s1.y);
  assertEquals("Wrong nested array element value after write/read",3,s.buffer[0]);
  assertSame("Array field reference should be unchanged",ref,s.buffer);
}
