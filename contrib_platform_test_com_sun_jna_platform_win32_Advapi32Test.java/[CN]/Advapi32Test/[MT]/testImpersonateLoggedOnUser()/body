{
  USER_INFO_1 userInfo=new USER_INFO_1();
  userInfo.usri1_name=new WString("JNAAdvapi32TestImp");
  userInfo.usri1_password=new WString("!JNAP$$Wrd0");
  userInfo.usri1_priv=LMAccess.USER_PRIV_USER;
  assertEquals(LMErr.NERR_Success,Netapi32.INSTANCE.NetUserAdd(null,1,userInfo,null));
  try {
    HANDLEByReference phUser=new HANDLEByReference();
    try {
      assertTrue(Advapi32.INSTANCE.LogonUser(userInfo.usri1_name.toString(),null,userInfo.usri1_password.toString(),WinBase.LOGON32_LOGON_NETWORK,WinBase.LOGON32_PROVIDER_DEFAULT,phUser));
      assertTrue(Advapi32.INSTANCE.ImpersonateLoggedOnUser(phUser.getValue()));
      assertTrue(Advapi32.INSTANCE.RevertToSelf());
    }
  finally {
      if (phUser.getValue() != WinBase.INVALID_HANDLE_VALUE) {
        Kernel32.INSTANCE.CloseHandle(phUser.getValue());
      }
    }
  }
  finally {
    assertEquals(LMErr.NERR_Success,Netapi32.INSTANCE.NetUserDel(null,userInfo.usri1_name.toString()));
  }
}
