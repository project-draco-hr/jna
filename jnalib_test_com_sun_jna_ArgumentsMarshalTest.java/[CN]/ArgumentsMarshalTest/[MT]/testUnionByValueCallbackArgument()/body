{
  TestLibrary.TestUnion arg=new TestLibrary.TestUnion();
  arg.setType(String.class);
  final String VALUE=getName();
  arg.f1=VALUE;
  final boolean[] called={false};
  final String[] cbvalue={null};
  TestLibrary.TestUnion result=lib.testUnionByValueCallbackArgument(new TestLibrary.UnionCallback(){
    public TestLibrary.TestUnion invoke(    TestLibrary.TestUnion v){
      called[0]=true;
      v.setType(String.class);
      v.read();
      cbvalue[0]=v.f1;
      return v;
    }
  }
,arg);
  assertTrue("Callback not called",called[0]);
  assertEquals("Incorrect callback union argument",VALUE,cbvalue[0]);
  assertEquals("Union value not propagated",VALUE,result.getTypedValue(String.class));
}
