{
  if (!Platform.isWindows())   return;
  monitor.addWatch(tmpdir);
  File file=File.createTempFile(getName(),".tmp",tmpdir);
  File newFile=new File(file.getParentFile(),"newfile");
  newFile.deleteOnExit();
  file.deleteOnExit();
  file.renameTo(newFile);
  FileEvent e1=(FileEvent)events.get(new Integer(FileMonitor.FILE_NAME_CHANGED_OLD));
  FileEvent e2=(FileEvent)events.get(new Integer(FileMonitor.FILE_NAME_CHANGED_NEW));
  long start=System.currentTimeMillis();
  while (System.currentTimeMillis() - start < 5000 && e1 == null && e2 == null) {
    Thread.sleep(10);
    e1=(FileEvent)events.get(new Integer(FileMonitor.FILE_NAME_CHANGED_OLD));
    e2=(FileEvent)events.get(new Integer(FileMonitor.FILE_NAME_CHANGED_NEW));
  }
  assertTrue("No events sent",events.size() != 0);
  assertNotNull("No rename event (old): " + events,e1);
  assertNotNull("No rename event (new): " + events,e2);
  assertEquals("Wrong target file for event (old)",file,e1.getFile());
  assertEquals("Wrong target file for event (new)",newFile,e2.getFile());
}
