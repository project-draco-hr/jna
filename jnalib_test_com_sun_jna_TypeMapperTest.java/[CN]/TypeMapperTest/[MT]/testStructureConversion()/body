{
  DefaultTypeMapper mapper=new DefaultTypeMapper();
  TypeConverter converter=new TypeConverter(){
    public Object toNative(    Object value){
      return new Integer(Boolean.TRUE.equals(value) ? 1 : 0);
    }
    public Object fromNative(    Object value,    FromNativeContext context){
      return new Boolean(((Integer)value).intValue() == 1);
    }
    public Class nativeType(){
      return Integer.class;
    }
  }
;
  mapper.addToNativeConverter(Boolean.class,converter);
  mapper.addFromNativeConverter(Boolean.class,converter);
  Map options=new HashMap();
  options.put(Library.OPTION_TYPE_MAPPER,mapper);
  StructureTestLibrary lib=(StructureTestLibrary)Native.loadLibrary("testlib",StructureTestLibrary.class,options);
  StructureTestLibrary.TestStructure s=new StructureTestLibrary.TestStructure(mapper);
  assertEquals("Wrong native size",4,s.size());
  s.data=true;
  s.write();
  assertEquals("Wrong value written",1,s.getPointer().getInt(0));
  s.getPointer().setInt(0,0);
  s.read();
  assertFalse("Wrong value read",s.data);
}
