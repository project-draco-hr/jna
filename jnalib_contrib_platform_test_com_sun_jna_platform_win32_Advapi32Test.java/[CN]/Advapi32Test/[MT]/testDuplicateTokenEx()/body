{
  HANDLEByReference hExistingToken=new HANDLEByReference();
  HANDLEByReference phNewToken=new HANDLEByReference();
  HANDLE processHandle=Kernel32.INSTANCE.GetCurrentProcess();
  assertTrue(Advapi32.INSTANCE.OpenProcessToken(processHandle,WinNT.TOKEN_DUPLICATE | WinNT.TOKEN_QUERY,hExistingToken));
  assertTrue(Advapi32.INSTANCE.DuplicateTokenEx(hExistingToken.getValue(),WinNT.GENERIC_READ,null,SECURITY_IMPERSONATION_LEVEL.SecurityAnonymous,TOKEN_TYPE.TokenPrimary,phNewToken));
  assertTrue(Kernel32.INSTANCE.CloseHandle(phNewToken.getValue()));
  assertTrue(Kernel32.INSTANCE.CloseHandle(hExistingToken.getValue()));
}
