{
  Map options=new HashMap();
  options.put(Library.OPTION_FUNCTION_MAPPER,new FunctionMapper(){
    public String getFunctionName(    NativeLibrary library,    Method m){
      if (m.getName().equals("noThrowLastError") || m.getName().equals("throwLastError")) {
        return "setLastError";
      }
      return m.getName();
    }
  }
);
  TestLibrary lib=(TestLibrary)Native.loadLibrary("testlib",TestLibrary.class,options);
  final int ERROR=-1;
  lib.noThrowLastError(ERROR);
  assertEquals("Last error not preserved",ERROR,Native.getLastError());
  try {
    lib.throwLastError(ERROR);
    fail("Method should throw LastErrorException");
  }
 catch (  LastErrorException e) {
    assertEquals("Exception should contain error code",ERROR,e.errorCode);
  }
}
