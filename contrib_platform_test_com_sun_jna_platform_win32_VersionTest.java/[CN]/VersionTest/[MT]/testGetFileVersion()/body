{
  String systemRoot=System.getenv("SystemRoot");
  File file=new File(systemRoot + "\\regedit.exe");
  if (!file.exists()) {
    fail("Can't obtain file version, file " + file + " is missing");
  }
  int size=Version.INSTANCE.GetFileVersionInfoSize(file.getAbsolutePath(),null);
  assertTrue(size > 0);
  Pointer buffer=Kernel32.INSTANCE.LocalAlloc(WinBase.LMEM_ZEROINIT,size);
  assertTrue(!buffer.equals(Pointer.NULL));
  try {
    assertTrue(Version.INSTANCE.GetFileVersionInfo(file.getAbsolutePath(),0,size,buffer));
    IntByReference outputSize=new IntByReference();
    PointerByReference pointer=new PointerByReference();
    assertTrue(Version.INSTANCE.VerQueryValue(buffer,"\\",pointer,outputSize));
    VerRsrc.VS_FIXEDFILEINFO fixedFileInfo=new VerRsrc.VS_FIXEDFILEINFO(pointer.getValue());
    assertTrue(fixedFileInfo.dwFileVersionLS.longValue() > 0);
    assertTrue(fixedFileInfo.dwFileVersionMS.longValue() > 0);
  }
  finally {
    Kernel32.INSTANCE.GlobalFree(buffer);
  }
}
