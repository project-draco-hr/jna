{
  super.setUp();
  Native.setProtected(true);
  System.out.println("JNA protected mode: " + Native.isProtected());
  HRESULT hr=Ole32.INSTANCE.CoInitialize(null);
  if (W32Errors.FAILED(hr)) {
    this.tearDown();
    throw new COMException("CoInitialize() failed");
  }
  CLSID.ByReference clsid=new CLSID.ByReference();
  hr=Ole32.INSTANCE.CLSIDFromProgID("Shell.Application",clsid);
  if (W32Errors.FAILED(hr)) {
    Ole32.INSTANCE.CoUninitialize();
    COMUtils.checkRC(hr);
  }
  hr=Ole32.INSTANCE.CoCreateInstance(clsid,null,WTypes.CLSCTX_SERVER,IDispatch.IID_IDispatch,this.pDispatch);
  if (W32Errors.FAILED(hr)) {
    COMUtils.checkRC(hr);
  }
  this.iDispatch=new Dispatch(pDispatch.getPointer());
}
