{
  final String UNICODE="\u0444\u043b\u0441\u0432\u0443";
  final String UNICODEZ=UNICODE + "\0more stuff";
  byte[] utf8=Native.getBytes(UNICODE);
  byte[] expected=UNICODE.getBytes(Native.DEFAULT_ENCODING);
  for (int i=0; i < Math.min(utf8.length,expected.length); i++) {
    assertEquals("Improperly encoded at " + i,expected[i],utf8[i]);
  }
  assertEquals("Wrong number of encoded characters",expected.length,utf8.length);
  String result=Native.toString(utf8);
  assertEquals("Improperly decoded",UNICODE,result);
  assertEquals("Should truncate bytes at NUL terminator",UNICODE,Native.toString(UNICODEZ.getBytes(Native.DEFAULT_ENCODING)));
}
