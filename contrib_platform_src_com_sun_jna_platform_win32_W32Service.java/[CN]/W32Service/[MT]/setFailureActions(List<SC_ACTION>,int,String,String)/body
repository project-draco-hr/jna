{
  SERVICE_FAILURE_ACTIONS.ByReference actionStruct=new SERVICE_FAILURE_ACTIONS.ByReference();
  actionStruct.dwResetPeriod=resetPeriod;
  if (rebootMsg != null) {
    actionStruct.lpRebootMsg=new Memory((rebootMsg.length() + 1) * Native.WCHAR_SIZE);
    actionStruct.lpRebootMsg.setWideString(0,rebootMsg);
  }
 else {
    actionStruct.lpRebootMsg=Pointer.NULL;
  }
  if (command != null) {
    actionStruct.lpCommand=new Memory((command.length() + 1) * Native.WCHAR_SIZE);
    actionStruct.lpCommand.setWideString(0,command);
  }
 else {
    actionStruct.lpCommand=Pointer.NULL;
  }
  actionStruct.cActions=actions.size();
  actionStruct.lpsaActions=new SC_ACTION.ByReference();
  SC_ACTION[] actionArray=(SC_ACTION[])actionStruct.lpsaActions.toArray(actions.size());
  boolean hasShutdownPrivilege=false;
  int i=0;
  for (  SC_ACTION action : actions) {
    if (!hasShutdownPrivilege && action.type == Winsvc.SC_ACTION_REBOOT) {
      addShutdownPrivilegeToProcess();
      hasShutdownPrivilege=true;
    }
    actionArray[i].type=action.type;
    actionArray[i].delay=action.delay;
    i++;
  }
  if (!Advapi32.INSTANCE.ChangeServiceConfig2W(_handle,Winsvc.SERVICE_CONFIG_FAILURE_ACTIONS,actionStruct)) {
    throw new Win32Exception(Kernel32.INSTANCE.GetLastError());
  }
}
