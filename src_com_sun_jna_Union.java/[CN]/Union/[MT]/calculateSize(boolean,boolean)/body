{
  int size=super.calculateSize(force,avoidFFIType);
  if (size != CALCULATE_SIZE) {
    int fsize=0;
    for (Iterator i=fields().values().iterator(); i.hasNext(); ) {
      StructField f=(StructField)i.next();
      f.offset=0;
      if (f.size > fsize || (f.size == fsize && Structure.class.isAssignableFrom(f.type))) {
        fsize=f.size;
        biggestField=f;
      }
    }
    size=calculateAlignedSize(fsize);
    if (size > 0) {
      if (this instanceof ByValue) {
        getTypeInfo();
      }
    }
  }
  return size;
}
