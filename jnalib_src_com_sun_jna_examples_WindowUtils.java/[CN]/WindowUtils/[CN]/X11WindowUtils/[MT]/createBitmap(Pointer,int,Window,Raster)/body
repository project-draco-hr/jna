{
  final X11 x11=X11.INSTANCE;
  Rectangle bounds=raster.getBounds();
  int width=bounds.x + bounds.width;
  int height=bounds.y + bounds.height;
  final int pm=x11.XCreatePixmap(dpy,win,width,height,1);
  final Pointer gc=x11.XCreateGC(dpy,pm,0,null);
  if (gc == null) {
    return X11.None;
  }
  x11.XSetForeground(dpy,gc,0);
  x11.XFillRectangle(dpy,pm,gc,0,0,width,height);
  final int UNMASKED=1;
  x11.XSetForeground(dpy,gc,UNMASKED);
  X11.XWindowAttributes atts=new X11.XWindowAttributes();
  int status=x11.XGetWindowAttributes(dpy,win,atts);
  if (status == 0) {
    return X11.None;
  }
  try {
    RasterRangesUtils.outputOccupiedRanges(raster,new RasterRangesUtils.RangesOutput(){
      public boolean outputRange(      int x,      int y,      int w,      int h){
        return x11.XFillRectangle(dpy,pm,gc,x,y,w,h) != 0;
      }
    }
);
  }
  finally {
    x11.XFreeGC(dpy,gc);
  }
  return pm;
}
