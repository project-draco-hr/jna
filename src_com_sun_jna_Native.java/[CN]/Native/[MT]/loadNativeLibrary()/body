{
  removeTemporaryFiles();
  String libName="jnidispatch";
  String bootPath=System.getProperty("jna.boot.library.path");
  if (bootPath != null) {
    String[] dirs=bootPath.split(File.pathSeparator);
    for (int i=0; i < dirs.length; ++i) {
      String path=new File(new File(dirs[i]),System.mapLibraryName(libName)).getAbsolutePath();
      try {
        System.load(path);
        nativeLibraryPath=path;
        return;
      }
 catch (      UnsatisfiedLinkError ex) {
      }
      if (Platform.isMac()) {
        String orig, ext;
        if (path.endsWith("dylib")) {
          orig="dylib";
          ext="jnilib";
        }
 else {
          orig="jnilib";
          ext="dylib";
        }
        try {
          path=path.substring(0,path.lastIndexOf(orig)) + ext;
          System.load(path);
          nativeLibraryPath=path;
          return;
        }
 catch (        UnsatisfiedLinkError ex) {
        }
      }
    }
  }
  try {
    if (!Boolean.getBoolean("jna.nosys")) {
      System.loadLibrary(libName);
      return;
    }
  }
 catch (  UnsatisfiedLinkError e) {
    if (Boolean.getBoolean("jna.nounpack")) {
      throw e;
    }
  }
  if (!Boolean.getBoolean("jna.nounpack")) {
    loadNativeLibraryFromJar();
    return;
  }
  throw new UnsatisfiedLinkError("Native jnidispatch library not found");
}
